name: Auto Deploy to Kucingarong

on:
  push:
    branches:
      - main
      - development

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Create deployment package
        run: |
          echo "ðŸ“¦ Membuat deploy.zip ..."
          zip -r deploy.zip . -x ".git/*" ".github/*"

      - name: Upload to Kucingarong
        run: |
          REPO_NAME=${{ github.event.repository.name }}
          AUTOHOST_URL="https://cicak.akhzafachrozy.my.id"  # ubah jika belum dikonfigurasi di Cloudflare

          echo "ðŸš€ Uploading to Kucingarong ($REPO_NAME)..."
          RESPONSE=$(curl -s -S -k -m 120 --connect-timeout 15 \
            -X POST \
            -F "repo=$REPO_NAME" \
            -F "file=@deploy.zip" \
            "$AUTOHOST_URL")

          echo "ðŸ“œ ===== RESPONSE DARI SERVER ====="
          echo "$RESPONSE"
          echo "ðŸ“œ ================================="
